(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{659:function(n,e,s){"use strict";s.r(e);var a=s(7),t=Object(a.a)({},(function(){var n=this,e=n.$createElement,s=n._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"title"}),s("p",[s("img",{attrs:{src:"https://atlas.pingcode.com/files/public/62309c31628df6b38b6f1263",alt:"image.png"}})])]),n._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/a876ce53880f048106d1ffedd8ae71a2.png",alt:"⭐️关注我 ，一起探索更多知识！⭐️"}})]),n._v(" "),s("p",[s("em",[n._v("更多相关文章")])]),n._v(" "),s("p",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=Mzg3NzY0NjY5OQ==&mid=2247484127&idx=1&sn=d819cfded9102b9a16d8a58070d75ac7&chksm=cf1e84dbf8690dcde5d2c47d4073b0a0aaa79b57521a845b2d387fb063bab8ab4e6cad991754#rd",target:"_blank",rel:"noopener noreferrer"}},[n._v("istio基本概念"),s("OutboundLink")],1)]),n._v(" "),s("p",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=Mzg3NzY0NjY5OQ==&mid=2247484137&idx=1&sn=65fbe4f279521a4d0de75692719b7475&chksm=cf1e84edf8690dfb9c6adf7788c77613e1f3776b47547a281860f627f2ea5077f7ef8cb97a45#rd",target:"_blank",rel:"noopener noreferrer"}},[n._v("手把手教你部署istio控制平面"),s("OutboundLink")],1)]),n._v(" "),s("p",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=Mzg3NzY0NjY5OQ==&mid=2247484163&idx=1&sn=d0d4eaab73dc8e950e46a789e4f40fb3&chksm=cf1e8507f8690c112fb75c5b99558eb15e4e8de9bf89e166bcd15304c74f7b55bedb97c8b77e&token=414749856&lang=zh_CN#rd",target:"_blank",rel:"noopener noreferrer"}},[n._v("四个案例让你掌握istio网格功能"),s("OutboundLink")],1)]),n._v(" "),s("p",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=Mzg3NzY0NjY5OQ==&mid=2247484245&idx=1&sn=859b0808beebc3fe660bc398ce4ffc68&chksm=cf1e8551f8690c47d435732e654890c105644d57d5175c01f74f892d0a6cdcb23db120c3c1bd#rd",target:"_blank",rel:"noopener noreferrer"}},[n._v("VirtualService实现Istio高级流量治理"),s("OutboundLink")],1)]),n._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#一、destinationrule-cr资源规范"}},[n._v("一、DestinationRule CR资源规范")])]),s("li",[s("a",{attrs:{href:"#二、destinationrule配置要点"}},[n._v("二、DestinationRule配置要点")])]),s("li",[s("a",{attrs:{href:"#三、destinationrule配置生效示意图"}},[n._v("三、DestinationRule配置生效示意图")])]),s("li",[s("a",{attrs:{href:"#四、destinationrule配置示例"}},[n._v("四、DestinationRule配置示例")]),s("ul",[s("li",[s("a",{attrs:{href:"#_4-1、circuitbreaker-trafficpolicy-负载均衡策略"}},[n._v("4.1、CircuitBreaker - TrafficPolicy 负载均衡策略")])]),s("li",[s("a",{attrs:{href:"#_4-2、circuitbreaker-trafficpolicy-connectionpool-连接池配置"}},[n._v("4.2、CircuitBreaker-TrafficPolicy-connectionPool 连接池配置")])])])])])]),s("p"),n._v(" "),s("h2",{attrs:{id:"一、destinationrule-cr资源规范"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、destinationrule-cr资源规范"}},[n._v("#")]),n._v(" 一、DestinationRule CR资源规范")]),n._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/e9ce945acff5a2efbf18c1092e18fe64.png",alt:"image.png"}})]),n._v(" "),s("h2",{attrs:{id:"二、destinationrule配置要点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、destinationrule配置要点"}},[n._v("#")]),n._v(" 二、DestinationRule配置要点")]),n._v(" "),s("ul",[s("li",[n._v("DestinationRule用于配置路由完成之后的应用于服务的流量策略，即配置如何将流量调度至上游端点，同时也是为 VirtualService的Destination指定的目标提供具体的定义和实现；主要包括以下配置项：\n"),s("ul",[s("li",[n._v("负载均衡配置")]),n._v(" "),s("li",[n._v("Sidecar连接池")]),n._v(" "),s("li",[n._v("异常值检测相关的配置，即异常端点驱逐机制")])])]),n._v(" "),s("li",[n._v("DestinationRule的关键字段 ：\n"),s("ul",[s("li",[n._v("host : 必选字段，指定规则适用对象，可以使用短域名；可用值是在服务注册中心注册的服务名，即网格内的服务或者是以 ServiceEntry注册的网格外的服务；")]),n._v(" "),s("li",[n._v("trafficPolicy : 具体的规则内容，包括负载均衡、连接池策略和异常值检测；")]),n._v(" "),s("li",[n._v("subsets : 服务的子集定义，通常一个子集用于定义一个服务版本；")]),n._v(" "),s("li",[n._v("exportTo : 用于控制DestinationRule 扩名称空间的可见性，即控制一个名称空间下定义的 DestinationRule 资源对象是否可被其他名称空间下的Sidecar执行;\n"),s("ul",[s("li",[n._v('"." : 表示仅应用于当前名称空间；')]),n._v(" "),s("li",[n._v('"*" : 表示应用于所有名称空间；')])])])])]),n._v(" "),s("li",[n._v("Subset : 服务子集\n"),s("ul",[s("li",[n._v("name : 子集名称")]),n._v(" "),s("li",[n._v("labels : 子集上的标签")]),n._v(" "),s("li",[n._v("trafficPolicy : 应用于当前子集的流量策略")])])])]),n._v(" "),s("p",[n._v("TrafficPolicy 主要包括如下几项重要配置")]),n._v(" "),s("ul",[s("li",[n._v("loadBalancer : 定义使用的负载均衡器，即负载均衡算法；\n"),s("ul",[s("li",[n._v("简单负载均衡 :  ROUND_ROBIN、LEAST_CONN、RANDON和PASSTHROUTH ;")]),n._v(" "),s("li",[n._v("一致性哈希 : consistentHash 仅对 HTTP 协议有效，它支持基于 httpHeaderName、httpCookie、useSourelp进行hash计算，并能够通过 minimumRingSize 指定Hash环大小；")])])]),n._v(" "),s("li",[n._v("outlierDetection : 异常值检测；\n"),s("ul",[s("li",[n._v("consecutiveErrors：实例被驱逐前的连续错误次数和，默认值为5；")]),n._v(" "),s("li",[n._v("interval：驱逐的时间间隔，默认值为10秒，支持以时、分、秒和毫秒为单位；")]),n._v(" "),s("li",[n._v("baseEjectionTime：基准驱逐时长，具体时长取决于退避算法；")]),n._v(" "),s("li",[n._v("maxEjectionPercent：可被驱逐的最大实例比例，默认为10%；")]),n._v(" "),s("li",[n._v("minHealthPercent：启用异常值检测时要满足的最小健康状态实例比例，小于此比例，异常值检测将被禁用；默认为50%；")])])]),n._v(" "),s("li",[n._v("connectionPool : 连接池配置；\n"),s("ul",[s("li",[n._v("TCP 连接池配置 :\n"),s("ul",[s("li",[n._v("maxConnections : 为上游服务的所有实例建立的最大连接数，默认为 1024；")]),n._v(" "),s("li",[n._v("connectTimeout : TCP 连接超时时长；对于HTTP协议而言，仅适用于HTTP/1;")]),n._v(" "),s("li",[n._v("tcpKeepalive : TCP keepalives 机制，通过定期给发送一个 keepalive 探测报文来判断连接是否可用；")])])]),n._v(" "),s("li",[n._v("HTTP 连接池配置 :\n"),s("ul",[s("li",[n._v("httpMaxPendingRequests : 允许挂起的最大HTTP请求数，默认为1024，仅适用于HTTP/1.1；")]),n._v(" "),s("li",[n._v("http2MaxRequests : 允许的HTTP/2 最大请求数，默认为1024；HTTP/1.1 的由maxConnections设置即能实现；")]),n._v(" "),s("li",[n._v("maxRequestsPerConnection : 每连接的最大请求数，默认为无限制，而1则表示禁用 Keep-alive；")]),n._v(" "),s("li",[n._v("maxRetries : 最大重试次数，默认为3；")]),n._v(" "),s("li",[n._v("idleTimeout : 空闲超时时长；")])])])])]),n._v(" "),s("li",[n._v("PortTrafficPolicy : 流量策略要应用的目标端口；")])]),n._v(" "),s("h2",{attrs:{id:"三、destinationrule配置生效示意图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、destinationrule配置生效示意图"}},[n._v("#")]),n._v(" 三、DestinationRule配置生效示意图")]),n._v(" "),s("p"),n._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/e8bc3c1199c89a6e72490fdc0da32a6f.png",alt:"image.png"}})]),n._v(" "),s("p"),n._v(" "),s("h2",{attrs:{id:"四、destinationrule配置示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、destinationrule配置示例"}},[n._v("#")]),n._v(" 四、DestinationRule配置示例")]),n._v(" "),s("h3",{attrs:{id:"_4-1、circuitbreaker-trafficpolicy-负载均衡策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1、circuitbreaker-trafficpolicy-负载均衡策略"}},[n._v("#")]),n._v(" 4.1、CircuitBreaker - TrafficPolicy 负载均衡策略")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('1、使用以下 DestinationRule 定义对访问demoapp 的负载均衡策略\n# cat destinationrule-demoapp.yaml\napiVersion: networking.istio.io/v1beta1\nkind: DestinationRule\nmetadata:\n  name: demoapp\nspec:\n  # 主机 ：对demoapp service 服务的访问\n  host: demoapp\n  # 全局负载均衡策略\n  trafficPolicy:\n    # 负载均衡策略\n    loadBalancer:\n      # 加权最少连接\n      simple: LEAST_CONN\n  # 子集\n  subsets:\n  # 名为 v10 的子集\n  - name: v10\n    labels:\n      version: v1.0\n    # v10 子集的负载均衡策略\n    trafficPolicy:\n      # 负载均衡策略\n      loadBalancer:\n        # 一致性哈希\n        consistentHash:\n          # 如果请求标头有 X-User 标头，如果 X-User标头值一样都将调度到同一个后端Pod，不一样的值则被重新调度\n          httpHeaderName: X-User\n  # 名为 v11 的子集\n  - name: v11\n    labels:\n      version: v1.1\n    # v11 子集并未定义负载均衡策略则继承全局负载均衡策略\n    \n# kubectl apply -f destinationrule-demoapp.yaml\ndestinationrule.networking.istio.io/demoapp configured\n\n# kubectl get destinationrule\nNAME      HOST      AGE\ndemoapp   demoapp   6d16h\n\n# 取出 ingress-gateway pod名称方便后续使用\n# InGW=$(kubectl get pods -n istio-system -l app=istio-ingressgateway -o jsonpath={.items[0].metadata.name})\nroot@native01:~# echo $InGW\nistio-ingressgateway-78f69bd5db-ln5vv\n\n2、生效回此前定义的 virtualservice 路由策略\n# cat 03-demoapp-subset/virutalservice-demoapp.yaml\napiVersion: networking.istio.io/v1beta1\nkind: VirtualService\nmetadata:\n  name: demoapp\nspec:\n  hosts:\n  - demoapp\n  http:\n  - name: canary\n    match:\n    - uri:\n        prefix: /canary\n    rewrite:\n      uri: /\n    route:\n    - destination:\n        host: demoapp\n        subset: v11\n  - name: default\n    route:\n    - destination:\n        host: demoapp\n        subset: v10\n\n# kubectl apply -f  03-demoapp-subset/virutalservice-demoapp.yaml\nvirtualservice.networking.istio.io/demoapp configured\n\n3、集群内直接使用 client直接对demoapp 进行访问测试\n# kubectl run client --image=registry.cn-wulanchabu.aliyuncs.com/daizhe/admin-box -it --rm --restart=Never --command -- /bin/sh\nIf you don t see a command prompt, try pressing enter.\n\n# 请求/canary 调度给 demoapp v11 子集，走 DestinationRule 全局负载均衡策略 -> 加权最少连接\nroot@client # curl demoapp:8080/canary\niKubernetes demoapp v1.1 !! ClientIP: 127.0.0.6, ServerName: demoappv11-7984f579f5-7nlrr, ServerIP: 10.220.104.143!\nroot@client # curl demoapp:8080/canary\niKubernetes demoapp v1.1 !! ClientIP: 127.0.0.6, ServerName: demoappv11-7984f579f5-ttfv9, ServerIP: 10.220.104.133!\n\n# 请求 / 调度给 demoapp v10 子集，走 DestinationRule v10 子集 负载均衡策略 -> 一致性哈希\nroot@client # curl -H "X-User: user" demoapp:8080\niKubernetes demoapp v1.0 !! ClientIP: 127.0.0.6, ServerName: demoappv10-5c497c6f7c-rvbwc, ServerIP: 10.220.104.147!\nroot@client # curl -H "X-User: user" demoapp:8080\niKubernetes demoapp v1.0 !! ClientIP: 127.0.0.6, ServerName: demoappv10-5c497c6f7c-rvbwc, ServerIP: 10.220.104.147!\nroot@client # curl -H "X-User: user" demoapp:8080\niKubernetes demoapp v1.0 !! ClientIP: 127.0.0.6, ServerName: demoappv10-5c497c6f7c-rvbwc, ServerIP: 10.220.104.147!\nroot@client #\nroot@client # curl -H "X-User: name" demoapp:8080\niKubernetes demoapp v1.0 !! ClientIP: 127.0.0.6, ServerName: demoappv10-5c497c6f7c-4sr86, ServerIP: 10.220.104.145!\nroot@client # curl -H "X-User: name" demoapp:8080\niKubernetes demoapp v1.0 !! ClientIP: 127.0.0.6, ServerName: demoappv10-5c497c6f7c-4sr86, ServerIP: 10.220.104.145!\nroot@client # curl -H "X-User: name" demoapp:8080\niKubernetes demoapp v1.0 !! ClientIP: 127.0.0.6, ServerName: demoappv10-5c497c6f7c-4sr86, ServerIP: 10.220.104.145!\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br"),s("span",{staticClass:"line-number"},[n._v("78")]),s("br"),s("span",{staticClass:"line-number"},[n._v("79")]),s("br"),s("span",{staticClass:"line-number"},[n._v("80")]),s("br"),s("span",{staticClass:"line-number"},[n._v("81")]),s("br"),s("span",{staticClass:"line-number"},[n._v("82")]),s("br"),s("span",{staticClass:"line-number"},[n._v("83")]),s("br"),s("span",{staticClass:"line-number"},[n._v("84")]),s("br"),s("span",{staticClass:"line-number"},[n._v("85")]),s("br"),s("span",{staticClass:"line-number"},[n._v("86")]),s("br"),s("span",{staticClass:"line-number"},[n._v("87")]),s("br"),s("span",{staticClass:"line-number"},[n._v("88")]),s("br"),s("span",{staticClass:"line-number"},[n._v("89")]),s("br"),s("span",{staticClass:"line-number"},[n._v("90")]),s("br"),s("span",{staticClass:"line-number"},[n._v("91")]),s("br"),s("span",{staticClass:"line-number"},[n._v("92")]),s("br"),s("span",{staticClass:"line-number"},[n._v("93")]),s("br"),s("span",{staticClass:"line-number"},[n._v("94")]),s("br"),s("span",{staticClass:"line-number"},[n._v("95")]),s("br"),s("span",{staticClass:"line-number"},[n._v("96")]),s("br"),s("span",{staticClass:"line-number"},[n._v("97")]),s("br"),s("span",{staticClass:"line-number"},[n._v("98")]),s("br"),s("span",{staticClass:"line-number"},[n._v("99")]),s("br"),s("span",{staticClass:"line-number"},[n._v("100")]),s("br")])]),s("p"),n._v(" "),s("h3",{attrs:{id:"_4-2、circuitbreaker-trafficpolicy-connectionpool-连接池配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2、circuitbreaker-trafficpolicy-connectionpool-连接池配置"}},[n._v("#")]),n._v(" 4.2、CircuitBreaker-TrafficPolicy-connectionPool 连接池配置")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("1、定义 VirtualService\n# cat virutalservice-demoapp.yaml\napiVersion: networking.istio.io/v1beta1\nkind: VirtualService\nmetadata:\n  name: demoapp\nspec:\n  hosts:\n  - demoapp\n  http:\n  - name: canary\n    match:\n    - uri:\n        prefix: /canary\n    rewrite:\n      uri: /\n    route:\n    - destination:\n        host: demoapp\n        subset: v11\n  - name: default\n    route:\n    - destination:\n        host: demoapp\n        subset: v10\n\n2、定义 DestinationRule\n# cat destinationrule-demoapp.yaml\napiVersion: networking.istio.io/v1beta1\nkind: DestinationRule\nmetadata:\n  name: demoapp\nspec:\n  host: demoapp\n  trafficPolicy:\n    loadBalancer:\n      simple: RANDOM\n    connectionPool:\n      tcp:\n        maxConnections: 100\n        connectTimeout: 30ms\n        tcpKeepalive:\n          time: 7200s\n          interval: 75s\n      http:\n        http2MaxRequests: 1000\n        maxRequestsPerConnection: 10\n    # 异常值检测\n    outlierDetection:\n      # 最大弹出比例 50%\n      maxEjectionPercent: 50\n      # 连续的 5xx 错误超过 5次 就开始弹出主机\n      consecutive5xxErrors: 5\n      # 检测时间间隔为 2分钟\n      interval: 2m\n      # 弹出的基准时长 1分钟\n      baseEjectionTime: 1m\n      # 健康主机小于 40% 时禁用弹出功能\n      minHealthPercent: 40\n  subsets:\n  - name: v10\n    labels:\n      version: v1.0\n  - name: v11\n    labels:\n      version: v1.1\n      \n# kubectl apply -f destinationrule-demoapp.yaml\ndestinationrule.networking.istio.io/demoapp configured\n\n3、验证访问测试\n# kubectl run client --image=registry.cn-wulanchabu.aliyuncs.com/daizhe/admin-box -it --rm --restart=Never --command -- /bin/sh\nroot@client /# while true; do curl proxy; sleep 0.$RANDOM; done\nProxying value: iKubernetes demoapp v1.0 !! ClientIP: 127.0.0.6, ServerName: demoappv10-5c497c6f7c-4sr86, ServerIP: 10.220.104.145!\n - Took 296 milliseconds.\nProxying value: iKubernetes demoapp v1.0 !! ClientIP: 127.0.0.6, ServerName: demoappv10-5c497c6f7c-h7nw6, ServerIP: 10.220.104.129!\n - Took 23 milliseconds.\nProxying value: iKubernetes demoapp v1.0 !! ClientIP: 127.0.0.6, ServerName: demoappv10-5c497c6f7c-4sr86, ServerIP: 10.220.104.145!\n - Took 4 milliseconds.\n \n# 外部访问测试\ndaizhe@localhost ~ % while true; do curl http://fe.toptops.top:52212/canary ; sleep 0.$RANDOM; done\nProxying value: iKubernetes demoapp v1.1 !! ClientIP: 127.0.0.6, ServerName: demoappv11-7984f579f5-ttfv9, ServerIP: 10.220.104.133!\n - Took 20 milliseconds.\nProxying value: iKubernetes demoapp v1.1 !! ClientIP: 127.0.0.6, ServerName: demoappv11-7984f579f5-ttfv9, ServerIP: 10.220.104.133!\n - Took 4 milliseconds.\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br"),s("span",{staticClass:"line-number"},[n._v("78")]),s("br"),s("span",{staticClass:"line-number"},[n._v("79")]),s("br"),s("span",{staticClass:"line-number"},[n._v("80")]),s("br"),s("span",{staticClass:"line-number"},[n._v("81")]),s("br"),s("span",{staticClass:"line-number"},[n._v("82")]),s("br"),s("span",{staticClass:"line-number"},[n._v("83")]),s("br"),s("span",{staticClass:"line-number"},[n._v("84")]),s("br"),s("span",{staticClass:"line-number"},[n._v("85")]),s("br"),s("span",{staticClass:"line-number"},[n._v("86")]),s("br")])])])}),[],!1,null,null,null);e.default=t.exports}}]);