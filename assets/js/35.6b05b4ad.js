(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{651:function(e,s,t){"use strict";t.r(s);var a=t(7),r=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[t("img",{attrs:{src:"https://atlas.pingcode.com/files/public/6237160ab57b01cedea524e4",alt:"image.png"}})])]),e._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#参考链接"}},[e._v("参考链接")])]),t("li",[t("a",{attrs:{href:"#一、kubernetes-资源相关"}},[e._v("一、Kubernetes 资源相关")]),t("ul",[t("li",[t("a",{attrs:{href:"#_1-1、cputhrottlinghigh"}},[e._v("1.1、CPUThrottlingHigh")])]),t("li",[t("a",{attrs:{href:"#_1-2、kubecpuovercommit"}},[e._v("1.2、KubeCPUOvercommit")])]),t("li",[t("a",{attrs:{href:"#_1-3、kubememoryovercommit"}},[e._v("1.3、KubeMemoryOvercommit")])]),t("li",[t("a",{attrs:{href:"#_1-4、kubecpuquotaovercommit"}},[e._v("1.4、KubeCPUQuotaOvercommit")])]),t("li",[t("a",{attrs:{href:"#_1-5、kubememoryquotaovercommit"}},[e._v("1.5、KubeMemoryQuotaOvercommit")])]),t("li",[t("a",{attrs:{href:"#_1-6、kubememquotaexceeded"}},[e._v("1.6、KubeMEMQuotaExceeded")])]),t("li",[t("a",{attrs:{href:"#_1-7、kubecpuquotaexceeded"}},[e._v("1.7、KubeCPUQuotaExceeded")])])])]),t("li",[t("a",{attrs:{href:"#二、kubernetes-存储相关"}},[e._v("二、Kubernetes 存储相关")]),t("ul",[t("li",[t("a",{attrs:{href:"#_2-1、kubepersistentvolumefillingup"}},[e._v("2.1、KubePersistentVolumeFillingUp")])]),t("li",[t("a",{attrs:{href:"#_2-2、kubepersistentvolumefillingup"}},[e._v("2.2、KubePersistentVolumeFillingUp")])]),t("li",[t("a",{attrs:{href:"#_2-3、kubepersistentvolumeerrors"}},[e._v("2.3、KubePersistentVolumeErrors")])])])]),t("li",[t("a",{attrs:{href:"#三、kubernetes-system-相关"}},[e._v("三、kubernetes system 相关")]),t("ul",[t("li",[t("a",{attrs:{href:"#_3-1、kubeversionmismatch"}},[e._v("3.1、KubeVersionMismatch")])]),t("li",[t("a",{attrs:{href:"#_3-2、kubeclienterrors"}},[e._v("3.2、KubeClientErrors")])])])]),t("li",[t("a",{attrs:{href:"#四、apiserver-相关"}},[e._v("四、APIServer 相关")]),t("ul",[t("li",[t("a",{attrs:{href:"#_4-1、kubeapierrorshigh"}},[e._v("4.1、KubeAPIErrorsHigh")])]),t("li",[t("a",{attrs:{href:"#_4-2、kubeclientcertificateexpiration"}},[e._v("4.2、KubeClientCertificateExpiration")])]),t("li",[t("a",{attrs:{href:"#_4-3、aggregatedapierrors"}},[e._v("4.3、AggregatedAPIErrors")])]),t("li",[t("a",{attrs:{href:"#_4-4、kubeapidown"}},[e._v("4.4、KubeAPIDown")])])])]),t("li",[t("a",{attrs:{href:"#五、kubelet-相关"}},[e._v("五、kubelet 相关")]),t("ul",[t("li",[t("a",{attrs:{href:"#_5-1、kubenodenotready"}},[e._v("5.1、KubeNodeNotReady")])]),t("li",[t("a",{attrs:{href:"#_5-3、kubelettoomanypods"}},[e._v("5.3、KubeletTooManyPods")])]),t("li",[t("a",{attrs:{href:"#_5-4、kubenodereadinessflapping"}},[e._v("5.4、KubeNodeReadinessFlapping")])]),t("li",[t("a",{attrs:{href:"#_5-5、kubeletdown"}},[e._v("5.5、KubeletDown")])])])]),t("li",[t("a",{attrs:{href:"#六、k8s集群组件"}},[e._v("六、K8S集群组件")]),t("ul",[t("li",[t("a",{attrs:{href:"#_6-1、kubeschedulerdown"}},[e._v("6.1、KubeSchedulerDown")])]),t("li",[t("a",{attrs:{href:"#_6-2、kubecontrollermanagerdown"}},[e._v("6.2、KubeControllerManagerDown")])])])]),t("li",[t("a",{attrs:{href:"#七、etcd相关"}},[e._v("七、etcd相关")]),t("ul",[t("li",[t("a",{attrs:{href:"#_7-1、etcdlived"}},[e._v("7.1、Etcdlived")])]),t("li",[t("a",{attrs:{href:"#_7-2、etcdcluseterunavailable"}},[e._v("7.2、EtcdCluseterUnavailable")])]),t("li",[t("a",{attrs:{href:"#_7-3、etcdleadercheck"}},[e._v("7.3、EtcdLeaderCheck")])]),t("li",[t("a",{attrs:{href:"#_7-4、etcdbackendfsync"}},[e._v("7.4、EtcdBackendFsync")])]),t("li",[t("a",{attrs:{href:"#_7-5、etcdwalfsync"}},[e._v("7.5、EtcdWalFsync")])]),t("li",[t("a",{attrs:{href:"#_7-6、etcddbsize"}},[e._v("7.6、EtcdDbSize")])]),t("li",[t("a",{attrs:{href:"#_7-7、etcdgrpc"}},[e._v("7.7、EtcdGrpc")])])])]),t("li",[t("a",{attrs:{href:"#八、coredns相关"}},[e._v("八、CoreDNS相关")]),t("ul",[t("li",[t("a",{attrs:{href:"#_8-1、dnsrequest"}},[e._v("8.1、DnsRequest")])]),t("li",[t("a",{attrs:{href:"#_8-2、dnsrequestfaild"}},[e._v("8.2、DnsRequestFaild")])]),t("li",[t("a",{attrs:{href:"#_8-3、dnspanic"}},[e._v("8.3、DnsPanic")])])])]),t("li",[t("a",{attrs:{href:"#九、node相关"}},[e._v("九、Node相关")]),t("ul",[t("li",[t("a",{attrs:{href:"#_9-1、nodeclocknotsynchronising"}},[e._v("9.1、NodeClockNotSynchronising")])]),t("li",[t("a",{attrs:{href:"#_9-2、nodeclockskewdetected"}},[e._v("9.2、NodeClockSkewDetected")])]),t("li",[t("a",{attrs:{href:"#_9-3、nodehighnumberconntrackentriesused"}},[e._v("9.3、NodeHighNumberConntrackEntriesUsed")])]),t("li",[t("a",{attrs:{href:"#_9-4、nodenetworkreceiveerrs"}},[e._v("9.4、NodeNetworkReceiveErrs")])]),t("li",[t("a",{attrs:{href:"#_9-5、nodenetworktransmiterrs"}},[e._v("9.5、NodeNetworkTransmitErrs")])]),t("li",[t("a",{attrs:{href:"#_9-6、nodefilesystemalmostoutoffiles"}},[e._v("9.6、NodeFilesystemAlmostOutOfFiles")])]),t("li",[t("a",{attrs:{href:"#_9-7、nodefilesystemfilesfillingup"}},[e._v("9.7、NodeFilesystemFilesFillingUp")])]),t("li",[t("a",{attrs:{href:"#_9-8、nodefilesystemalmostoutofspace"}},[e._v("9.8、NodeFilesystemAlmostOutOfSpace")])]),t("li",[t("a",{attrs:{href:"#_9-9、nodefilesystemspacefillingup"}},[e._v("9.9、NodeFilesystemSpaceFillingUp")])])])]),t("li",[t("a",{attrs:{href:"#十、pod相关"}},[e._v("十、Pod相关")]),t("ul",[t("li",[t("a",{attrs:{href:"#_10-1、kubepodcrashlooping"}},[e._v("10.1、KubePodCrashLooping")])]),t("li",[t("a",{attrs:{href:"#_10-2、kubepodnotready"}},[e._v("10.2、KubePodNotReady")])]),t("li",[t("a",{attrs:{href:"#_10-3、kubedeploymentgenerationmismatch"}},[e._v("10.3、KubeDeploymentGenerationMismatch")])]),t("li",[t("a",{attrs:{href:"#_10-4、kubedeploymentreplicasmismatch"}},[e._v("10.4、KubeDeploymentReplicasMismatch")])]),t("li",[t("a",{attrs:{href:"#_10-5、kubestatefulsetreplicasmismatch"}},[e._v("10.5、KubeStatefulSetReplicasMismatch")])]),t("li",[t("a",{attrs:{href:"#_10-6、kubestatefulsetupdatenotrolledout"}},[e._v("10.6、KubeStatefulSetUpdateNotRolledOut")])]),t("li",[t("a",{attrs:{href:"#_10-7、kubedaemonsetrolloutstuck"}},[e._v("10.7、KubeDaemonSetRolloutStuck")])]),t("li",[t("a",{attrs:{href:"#_10-8、kubedaemonsetmisscheduled"}},[e._v("10.8、KubeDaemonSetMisScheduled")])]),t("li",[t("a",{attrs:{href:"#_10-9、kubecontainerwaiting"}},[e._v("10.9、KubeContainerWaiting")])])])])])]),t("p"),e._v(" "),t("ul",[t("li",[e._v("我们在工作中使用Prometheus监控K8S集群时，很容易发现有各种各样大量的告警 Rules，那么哪些是Rules需要我们重点需要关注的呢 ？在这里 Brains为大家梳理出一下 10组 较为重要的监控指标 （可能以下指标可能会受Prometheus版本影响，仅供参考）；")])]),e._v(" "),t("blockquote",[t("h2",{attrs:{id:"参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[e._v("#")]),e._v(" 参考链接")]),e._v(" "),t("ol",[t("li",[e._v("https://my.oschina.net/54188zz/blog/4305978")]),e._v(" "),t("li",[e._v("https://github.com/coreos/kube-prometheus")]),e._v(" "),t("li",[e._v("https://github.com/kubernetes-monitoring/kubernetes-mixin")]),e._v(" "),t("li",[e._v("https://blog.csdn.net/easylife206/article/details/108656220")])])]),e._v(" "),t("h2",{attrs:{id:"一、kubernetes-资源相关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、kubernetes-资源相关"}},[e._v("#")]),e._v(" 一、Kubernetes 资源相关")]),e._v(" "),t("h3",{attrs:{id:"_1-1、cputhrottlinghigh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1、cputhrottlinghigh"}},[e._v("#")]),e._v(" 1.1、CPUThrottlingHigh")]),e._v(" "),t("ul",[t("li",[e._v("CPU 的 limit 合理性指标，查出最近5分钟，超过25%的 CPU 执行周期受到限制的容器，表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('sum(increase(container_cpu_cfs_throttled_periods_total{container!="", }[5m])) by (container, pod, namespace)\n          /\nsum(increase(container_cpu_cfs_periods_total{}[5m])) by (container, pod, namespace)\n          > ( 25 / 100 )\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("p"),e._v(" "),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("container_cpu_cfs_periods_total : 容器生命周期中度过的 cpu 周期总数")]),e._v(" "),t("li",[e._v("container_cpu_cfs_throttled_periods_total : 容器生命周期中度过的受限的 cpu 周期总数")])])])]),e._v(" "),t("h3",{attrs:{id:"_1-2、kubecpuovercommit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2、kubecpuovercommit"}},[e._v("#")]),e._v(" 1.2、KubeCPUOvercommit")]),e._v(" "),t("ul",[t("li",[e._v("集群 CPU 过度使用，CPU 已经过度使用无法容忍节点故障，节点资源使用的总量超过节点的 CPU 总量，所以如果有节点故障将影响集群资源运行因为所需资源将无法被分配。表达式 ：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sum(namespace:kube_pod_container_resource_requests_cpu_cores:sum{})\n          /\nsum(kube_node_status_allocatable_cpu_cores)\n          >\n(count(kube_node_status_allocatable_cpu_cores)-1) / count(kube_node_status_allocatable_cpu_cores)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kube_pod_container_resource_requests_cpu_cores：资源 CPU 使用的 cores 数量")]),e._v(" "),t("li",[e._v("kube_node_status_allocatable_cpu_cores：节点 CPU cores 数量")])])])]),e._v(" "),t("h3",{attrs:{id:"_1-3、kubememoryovercommit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3、kubememoryovercommit"}},[e._v("#")]),e._v(" 1.3、KubeMemoryOvercommit")]),e._v(" "),t("ul",[t("li",[e._v("集群内存过度使用，内存已经过度使用无法容忍节点故障，节点资源使用的总量超过节点的内存总量，所以如果有节点故障将影响集群资源运行因为所需资源将无法被分配。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sum(namespace:kube_pod_container_resource_requests_memory_bytes:sum{})\n          /\n        sum(kube_node_status_allocatable_memory_bytes)\n          >\n        (count(kube_node_status_allocatable_memory_bytes)-1)\n          /\n        count(kube_node_status_allocatable_memory_bytes)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kube_pod_container_resource_requests_memory_bytes：资源内存使用的量")]),e._v(" "),t("li",[e._v("kube_node_status_allocatable_memory_bytes：节点内存量")])])])]),e._v(" "),t("h3",{attrs:{id:"_1-4、kubecpuquotaovercommit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4、kubecpuquotaovercommit"}},[e._v("#")]),e._v(" 1.4、KubeCPUQuotaOvercommit")]),e._v(" "),t("ul",[t("li",[e._v("集群CPU是否超分，查看 CPU 资源分配的额度是否超过进群总额度。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('sum(kube_pod_container_resource_limits_cpu_cores{job="kube-state-metrics"})\n          /\n        sum(kube_node_status_allocatable_cpu_cores)\n          > 1.1\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kube_pod_container_resource_limits_cpu_cores：资源分配的 CPU 资源额度")]),e._v(" "),t("li",[e._v("kube_node_status_allocatable_cpu_cores：节点 CPU 总量")])])])]),e._v(" "),t("h3",{attrs:{id:"_1-5、kubememoryquotaovercommit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5、kubememoryquotaovercommit"}},[e._v("#")]),e._v(" 1.5、KubeMemoryQuotaOvercommit")]),e._v(" "),t("ul",[t("li",[e._v("集群超分内存，查看内存资源分配的额度是否超过进群总额度。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('sum(kube_pod_container_resource_limits_memory_bytes{job="kube-state-metrics"})\n          /\n        sum(kube_node_status_allocatable_memory_bytes{job="kube-state-metrics"})\n          > 1.1\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("ul",[t("li",[e._v("相关指标:\n"),t("ul",[t("li",[e._v("kube_pod_container_resource_limits_memory_bytes：资源配额内存量")]),e._v(" "),t("li",[e._v("kube_node_status_allocatable_memory_bytes：节点内存量")])])])]),e._v(" "),t("h3",{attrs:{id:"_1-6、kubememquotaexceeded"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-6、kubememquotaexceeded"}},[e._v("#")]),e._v(" 1.6、KubeMEMQuotaExceeded")]),e._v(" "),t("ul",[t("li",[e._v("命名空间级内存资源使用的比例，关乎资源配额。当使用 request 和 limit 限制资源时，使用值和最大值还是有一点区别，当有 request 时说明最低分配了这么多资源。需要注意当 request 等于 limit 时那么说明资源已经是100%已经分配使用当监控告警发出的时候需要区分。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('sum (kube_pod_container_resource_requests_memory_bytes{job="kube-state-metrics"} ) by (namespace)\n    / (sum(kube_pod_container_resource_limits_memory_bytes{job="kube-state-metrics"}) by (namespace)) \n    > 0.8\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("ul",[t("li",[e._v("相关指标:\n"),t("ul",[t("li",[e._v("kube_pod_container_resource_requests_memory_bytes：内存资源使用量")]),e._v(" "),t("li",[e._v("kube_pod_container_resource_limits_memory_bytes：内存资源最大值")])])])]),e._v(" "),t("h3",{attrs:{id:"_1-7、kubecpuquotaexceeded"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-7、kubecpuquotaexceeded"}},[e._v("#")]),e._v(" 1.7、KubeCPUQuotaExceeded")]),e._v(" "),t("ul",[t("li",[e._v("命名空间级 CPU 资源使用的比例，关乎资源配额。当使用 request 和 limit 限制资源时，使用值和最大值还是有一点区别，当有 request 时说明最低分配了这么多资源。需要注意当 request 等于 limit 时那么说明资源已经是100%已经分配使用当监控告警发出的时候需要区分。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('sum (kube_pod_container_resource_requests_cpu_cores{job="kube-state-metrics"} ) by (namespace)\n    / (sum(kube_pod_container_resource_limits_cpu_cores{job="kube-state-metrics"}) by (namespace)) \n    > 0.8\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("ul",[t("li",[e._v("相关指标:\n"),t("ul",[t("li",[e._v("kube_pod_container_resource_requests_cpu_cores：CPU 使用量")]),e._v(" "),t("li",[e._v("kube_pod_container_resource_limits_cpu_cores：CPU 限额最大值")])])])]),e._v(" "),t("h2",{attrs:{id:"二、kubernetes-存储相关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、kubernetes-存储相关"}},[e._v("#")]),e._v(" 二、Kubernetes 存储相关")]),e._v(" "),t("h3",{attrs:{id:"_2-1、kubepersistentvolumefillingup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1、kubepersistentvolumefillingup"}},[e._v("#")]),e._v(" 2.1、KubePersistentVolumeFillingUp")]),e._v(" "),t("ul",[t("li",[e._v("PVC 容量监控，表达式 ：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('kubelet_volume_stats_available_bytes{job="kubelet", metrics_path="/metrics"}\n          /\n        kubelet_volume_stats_capacity_bytes{job="kubelet", metrics_path="/metrics"}\n          < 0.3\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kubelet_volume_stats_available_bytes：剩余空间")]),e._v(" "),t("li",[e._v("kubelet_volume_stats_capacity_bytes：空间总量")])])])]),e._v(" "),t("h3",{attrs:{id:"_2-2、kubepersistentvolumefillingup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2、kubepersistentvolumefillingup"}},[e._v("#")]),e._v(" 2.2、KubePersistentVolumeFillingUp")]),e._v(" "),t("ul",[t("li",[e._v("磁盘空间耗尽预测，通过PVC资源使用6小时变化率预测 接下来4天的磁盘使用率。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('(kubelet_volume_stats_available_bytes{job="kubelet", metrics_path="/metrics"}\n            /\n          kubelet_volume_stats_capacity_bytes{job="kubelet", metrics_path="/metrics"}\n        ) < 0.4\n        and\n        predict_linear(kubelet_volume_stats_available_bytes{job="kubelet", metrics_path="/metrics"}[6h], 4 * 24 * 3600) < 0\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br")])]),t("ul",[t("li",[e._v("相关指标:\n"),t("ul",[t("li",[e._v("kubelet_volume_stats_available_bytes：剩余空间")]),e._v(" "),t("li",[e._v("kubelet_volume_stats_capacity_bytes：空间总量")])])])]),e._v(" "),t("h3",{attrs:{id:"_2-3、kubepersistentvolumeerrors"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3、kubepersistentvolumeerrors"}},[e._v("#")]),e._v(" 2.3、KubePersistentVolumeErrors")]),e._v(" "),t("ul",[t("li",[e._v("PV 使用状态监控，表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('kube_persistentvolume_status_phase{phase=~"Failed|Pending",job="kube-state-metrics"}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kube_persistentvolume_status_phase：PV 使用状态")])])])]),e._v(" "),t("h2",{attrs:{id:"三、kubernetes-system-相关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、kubernetes-system-相关"}},[e._v("#")]),e._v(" 三、kubernetes system 相关")]),e._v(" "),t("h3",{attrs:{id:"_3-1、kubeversionmismatch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1、kubeversionmismatch"}},[e._v("#")]),e._v(" 3.1、KubeVersionMismatch")]),e._v(" "),t("ul",[t("li",[e._v("组件版本与当前集群版本是否有差异，对比组件版本是否有差异，默认为1 。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('count(count by (gitVersion) (label_replace(kubernetes_build_info{job!~"kube-dns|coredns"},"gitVersion","$1","gitVersion","(v[0-9]*.[0-9]*.[0-9]*).*")))\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kubernetes_build_info：获取组件信息")])])])]),e._v(" "),t("h3",{attrs:{id:"_3-2、kubeclienterrors"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2、kubeclienterrors"}},[e._v("#")]),e._v(" 3.2、KubeClientErrors")]),e._v(" "),t("ul",[t("li",[e._v("客户端访问某些接口的错误率。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('(sum(rate(rest_client_requests_total{code=~"5.."}[5m])) by (instance, job)\n          /\n        sum(rate(rest_client_requests_total[5m])) by (instance, job))\n        > 0.01\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("rest_client_requests_total：状态码")])])])]),e._v(" "),t("h2",{attrs:{id:"四、apiserver-相关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、apiserver-相关"}},[e._v("#")]),e._v(" 四、APIServer 相关")]),e._v(" "),t("h3",{attrs:{id:"_4-1、kubeapierrorshigh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1、kubeapierrorshigh"}},[e._v("#")]),e._v(" 4.1、KubeAPIErrorsHigh")]),e._v(" "),t("ul",[t("li",[e._v("APIServer 请求错误率，5分钟内 APIServer 请求错误率。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('sum(rate(apiserver_request_total{job="apiserver",code=~"5.."}[5m])) by (resource,subresource,verb)\n          /\n        sum(rate(apiserver_request_total{job="apiserver"}[5m])) by (resource,subresource,verb) > 0.05\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("apiserver_request_total：APIServer 请求数")])])])]),e._v(" "),t("h3",{attrs:{id:"_4-2、kubeclientcertificateexpiration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2、kubeclientcertificateexpiration"}},[e._v("#")]),e._v(" 4.2、KubeClientCertificateExpiration")]),e._v(" "),t("ul",[t("li",[e._v("kubelet 客户端证书过期，监测证书状态30天告警和7天告警。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('apiserver_client_certificate_expiration_seconds_count{job="apiserver"} > 0 and on(job) histogram_quantile(0.01, sum by (job, le) (rate(apiserver_client_certificate_expiration_seconds_bucket{job="apiserver"}[5m]))) < 2592000\napiserver_client_certificate_expiration_seconds_count{job="apiserver"} > 0 and on(job) histogram_quantile(0.01, sum by (job, le) (rate(apiserver_client_certificate_expiration_seconds_bucket{job="apiserver"}[5m]))) < 604800\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("apiserver_client_certificate_expiration_seconds_count：证书有效剩余时间")])])])]),e._v(" "),t("p"),e._v(" "),t("h3",{attrs:{id:"_4-3、aggregatedapierrors"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3、aggregatedapierrors"}},[e._v("#")]),e._v(" 4.3、AggregatedAPIErrors")]),e._v(" "),t("ul",[t("li",[e._v("自定义注册的 APIServer 服务可用性监控，当检测到自定义注册的 APIServer 五分钟不用次数达到2次。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sum by(name, namespace)(increase(aggregator_unavailable_apiservice_count[5m])) > 2\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("相关指标:\n"),t("ul",[t("li",[e._v("aggregator_unavailable_apiservice_count：监测自定义注册的 APIService 不可用次数。")])])])]),e._v(" "),t("p"),e._v(" "),t("h3",{attrs:{id:"_4-4、kubeapidown"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4、kubeapidown"}},[e._v("#")]),e._v(" 4.4、KubeAPIDown")]),e._v(" "),t("ul",[t("li",[e._v("APIserver 失联，监控 APIServer 服务，失联原因可能是服务 down 还可能是网络出现状况。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('absent(up{job="apiserver"} == 1)\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"五、kubelet-相关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#五、kubelet-相关"}},[e._v("#")]),e._v(" 五、kubelet 相关")]),e._v(" "),t("h3",{attrs:{id:"_5-1、kubenodenotready"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1、kubenodenotready"}},[e._v("#")]),e._v(" 5.1、KubeNodeNotReady")]),e._v(" "),t("ul",[t("li",[e._v("节点是否处于就绪状态，检测节点是否为就绪状态，或者可能是 kubelet 服务down 了。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('kube_node_status_condition{job="kube-state-metrics",condition="Ready",status="true"} == 0\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kube_node_status_condition：节点状态监测")])])])]),e._v(" "),t("h4",{attrs:{id:"_5-2、kubenodeunreachable"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2、kubenodeunreachable"}},[e._v("#")]),e._v(" 5.2、KubeNodeUnreachable")]),e._v(" "),t("ul",[t("li",[e._v("节点状态为 Unreachable。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('kube_node_spec_unschedulable{job="kube-state-metrics"} == 1\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h3",{attrs:{id:"_5-3、kubelettoomanypods"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-3、kubelettoomanypods"}},[e._v("#")]),e._v(" 5.3、KubeletTooManyPods")]),e._v(" "),t("ul",[t("li",[e._v("节点运行过多的 Pod，监测节点上运行的 Pods 数量。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('max(max(kubelet_running_pod_count{job="kubelet", metrics_path="/metrics"}) by(instance) * on(instance) group_left(node) kubelet_node_name{job="kubelet", metrics_path="/metrics"}) by(node) \n    / max(kube_node_status_capacity_pods{job="kube-state-metrics"} != 1) by(node) > 0.95\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kubelet_running_pod_count：节点运行的 Pods 数量")]),e._v(" "),t("li",[e._v("kubelet_node_name：节点名称")]),e._v(" "),t("li",[e._v("kube_node_status_capacity_pods：节点可运行的最大 Pod 数量")])])])]),e._v(" "),t("p"),e._v(" "),t("h3",{attrs:{id:"_5-4、kubenodereadinessflapping"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4、kubenodereadinessflapping"}},[e._v("#")]),e._v(" 5.4、KubeNodeReadinessFlapping")]),e._v(" "),t("ul",[t("li",[e._v("监测集群状态，查看集群内节点状态改变的频率。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('sum(changes(kube_node_status_condition{status="true",condition="Ready"}[15m])) by (node) > 2\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h3",{attrs:{id:"_5-5、kubeletdown"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-5、kubeletdown"}},[e._v("#")]),e._v(" 5.5、KubeletDown")]),e._v(" "),t("ul",[t("li",[e._v("监控 kubelet 服务，down 或者网络出现问题。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('absent(up{job="kubelet", metrics_path="/metrics"} == 1)\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"六、k8s集群组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#六、k8s集群组件"}},[e._v("#")]),e._v(" 六、K8S集群组件")]),e._v(" "),t("h3",{attrs:{id:"_6-1、kubeschedulerdown"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-1、kubeschedulerdown"}},[e._v("#")]),e._v(" 6.1、KubeSchedulerDown")]),e._v(" "),t("ul",[t("li",[e._v("KubeScheduler 失联，监测 KubeScheduler 是否正常。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('absent(up{job="kube-scheduler"} == 1)\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p"),e._v(" "),t("h3",{attrs:{id:"_6-2、kubecontrollermanagerdown"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2、kubecontrollermanagerdown"}},[e._v("#")]),e._v(" 6.2、KubeControllerManagerDown")]),e._v(" "),t("ul",[t("li",[e._v("监测 KubeControllerManager 服务，Down 或者网络不通。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('absent(up{job="kube-controller-manager"} == 1)\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"七、etcd相关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#七、etcd相关"}},[e._v("#")]),e._v(" 七、etcd相关")]),e._v(" "),t("h3",{attrs:{id:"_7-1、etcdlived"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-1、etcdlived"}},[e._v("#")]),e._v(" 7.1、Etcdlived")]),e._v(" "),t("ul",[t("li",[e._v("etcd 存活检测。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('up{job="etcd"} < 1\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h3",{attrs:{id:"_7-2、etcdcluseterunavailable"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-2、etcdcluseterunavailable"}},[e._v("#")]),e._v(" 7.2、EtcdCluseterUnavailable")]),e._v(" "),t("ul",[t("li",[e._v("etcd 集群健康检查，down 数量大于集群可允许故障数量。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('count(up{job="etcd"} == 0) > (count(up{job="etcd"}) / 2 - 1)\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p"),e._v(" "),t("h3",{attrs:{id:"_7-3、etcdleadercheck"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-3、etcdleadercheck"}},[e._v("#")]),e._v(" 7.3、EtcdLeaderCheck")]),e._v(" "),t("ul",[t("li",[e._v("检查 leader。表达式")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("max(etcd_server_has_leader) != 1\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p"),e._v(" "),t("h3",{attrs:{id:"_7-4、etcdbackendfsync"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-4、etcdbackendfsync"}},[e._v("#")]),e._v(" 7.4、EtcdBackendFsync")]),e._v(" "),t("ul",[t("li",[e._v("etcd io 监测，后端提交 延时。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("histogram_quantile(0.99, sum(rate(etcd_disk_backend_commit_duration_seconds_bucket[5m])) by (instance, le)) > 100\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h3",{attrs:{id:"_7-5、etcdwalfsync"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-5、etcdwalfsync"}},[e._v("#")]),e._v(" 7.5、EtcdWalFsync")]),e._v(" "),t("ul",[t("li",[e._v("etcd io 监测，文件同步到磁盘延时。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("histogram_quantile(0.99, sum(rate(etcd_disk_wal_fsync_duration_seconds_bucket[5m])) by (instance, le)) > 100\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h3",{attrs:{id:"_7-6、etcddbsize"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-6、etcddbsize"}},[e._v("#")]),e._v(" 7.6、EtcdDbSize")]),e._v(" "),t("ul",[t("li",[e._v("检测数据库大小。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("etcd_debugging_mvcc_db_total_size_in_bytes/1024/1024 > 1024\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h3",{attrs:{id:"_7-7、etcdgrpc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-7、etcdgrpc"}},[e._v("#")]),e._v(" 7.7、EtcdGrpc")]),e._v(" "),t("ul",[t("li",[e._v("Grpc 调用速率。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('sum(rate(grpc_server_handled_total{grpc_type="unary"}[1m])) > 100\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"八、coredns相关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#八、coredns相关"}},[e._v("#")]),e._v(" 八、CoreDNS相关")]),e._v(" "),t("h3",{attrs:{id:"_8-1、dnsrequest"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-1、dnsrequest"}},[e._v("#")]),e._v(" 8.1、DnsRequest")]),e._v(" "),t("ul",[t("li",[e._v("DNS 查询速率，每分钟查询超过100告警。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('sum(irate(coredns_dns_request_count_total{zone !="dropped"}[1m])) > 100\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h3",{attrs:{id:"_8-2、dnsrequestfaild"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-2、dnsrequestfaild"}},[e._v("#")]),e._v(" 8.2、DnsRequestFaild")]),e._v(" "),t("ul",[t("li",[e._v("异常查询，异常状态码，不是 NOERROR。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('irate(coredns_dns_response_rcode_count_total{rcode!="NOERROR"} [1m]) > 0\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("coredns_dns_response_rcode_count_total：查询返回状态码")])])])]),e._v(" "),t("blockquote",[t("p",[e._v("DNS-Rcode 作为 DNS 应答报文中有效的字段，主要用来说明 DNS 应答状态，是排查域名解析失败的重要指标。通常常见的 Rcode 值如下：")]),e._v(" "),t("ul",[t("li",[e._v("Rcode 值为0，对应的 DNS 应答状态为 NOERROR，意思是成功的响应，即这个域名解析是成功")]),e._v(" "),t("li",[e._v("Rcode 值为2，对应的 DNS 应答状态为 SERVFAIL，意思是服务器失败，也就是这个域名的权威服务器拒绝响应或者响应 REFUSE，递归服务器返回 Rcode 值为 2 给 CLIENT")]),e._v(" "),t("li",[e._v("Rcode 值为3，对应的 DNS 应答状态为 NXDOMAIN，意思是不存在的记录，也就是这个具体的域名在权威服务器中并不存在")]),e._v(" "),t("li",[e._v("Rcode 值为5，对应的 DNS 应答状态为 REFUSE，意思是拒绝，也就是这个请求源IP不在服务的范围内")])])]),e._v(" "),t("h3",{attrs:{id:"_8-3、dnspanic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-3、dnspanic"}},[e._v("#")]),e._v(" 8.3、DnsPanic")]),e._v(" "),t("ul",[t("li",[e._v("DNS 恐慌值，可能收到攻击。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("irate(coredns_panic_count_total[1m]) > 100\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"九、node相关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#九、node相关"}},[e._v("#")]),e._v(" 九、Node相关")]),e._v(" "),t("h3",{attrs:{id:"_9-1、nodeclocknotsynchronising"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-1、nodeclocknotsynchronising"}},[e._v("#")]),e._v(" 9.1、NodeClockNotSynchronising")]),e._v(" "),t("ul",[t("li",[e._v("主机与时间服务器失联。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("min_over_time(node_timex_sync_status[5m]) == 0\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("node_timex_sync_status：同步状态。")])])])]),e._v(" "),t("h3",{attrs:{id:"_9-2、nodeclockskewdetected"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-2、nodeclockskewdetected"}},[e._v("#")]),e._v(" 9.2、NodeClockSkewDetected")]),e._v(" "),t("ul",[t("li",[e._v("本地时间偏移量。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("(node_timex_offset_seconds > 0.05\n        and\n          deriv(node_timex_offset_seconds[5m]) >= 0\n        )\n        or\n        (\n          node_timex_offset_seconds < -0.05\n        and\n          deriv(node_timex_offset_seconds[5m]) <= 0)\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("node_timex_offset_seconds：误差")])])])]),e._v(" "),t("h3",{attrs:{id:"_9-3、nodehighnumberconntrackentriesused"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-3、nodehighnumberconntrackentriesused"}},[e._v("#")]),e._v(" 9.3、NodeHighNumberConntrackEntriesUsed")]),e._v(" "),t("ul",[t("li",[e._v("链接状态跟踪。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("(node_nf_conntrack_entries / node_nf_conntrack_entries_limit) > 0.75\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("node_nf_conntrack_entries：链接状态跟踪表分配的数量")]),e._v(" "),t("li",[e._v("node_nf_conntrack_entries_limit：表总量")])])])]),e._v(" "),t("h3",{attrs:{id:"_9-4、nodenetworkreceiveerrs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-4、nodenetworkreceiveerrs"}},[e._v("#")]),e._v(" 9.4、NodeNetworkReceiveErrs")]),e._v(" "),t("ul",[t("li",[e._v("网卡接收错误量。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("increase(node_network_receive_errs_total[2m]) > 10\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("node_network_receive_errs_total：接收错误总量")])])])]),e._v(" "),t("h3",{attrs:{id:"_9-5、nodenetworktransmiterrs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-5、nodenetworktransmiterrs"}},[e._v("#")]),e._v(" 9.5、NodeNetworkTransmitErrs")]),e._v(" "),t("ul",[t("li",[e._v("网卡传输错误量。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("increase(node_network_transmit_errs_total[2m]) > 10\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("node_network_transmit_errs_total：传输错误总量")])])])]),e._v(" "),t("h3",{attrs:{id:"_9-6、nodefilesystemalmostoutoffiles"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-6、nodefilesystemalmostoutoffiles"}},[e._v("#")]),e._v(" 9.6、NodeFilesystemAlmostOutOfFiles")]),e._v(" "),t("ul",[t("li",[e._v("inode 数量监测。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('(\n          node_filesystem_files_free{job="node-exporter",fstype!=""} / node_filesystem_files{job="node-exporter",fstype!=""} * 100 < 5\n        and\n          node_filesystem_readonly{job="node-exporter",fstype!=""} == 0\n        )\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("node_filesystem_files_free：空闲的 inode")]),e._v(" "),t("li",[e._v("node_filesystem_files：inodes 总量")])])])]),e._v(" "),t("h3",{attrs:{id:"_9-7、nodefilesystemfilesfillingup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-7、nodefilesystemfilesfillingup"}},[e._v("#")]),e._v(" 9.7、NodeFilesystemFilesFillingUp")]),e._v(" "),t("ul",[t("li",[e._v("inode 耗尽预测，以6小时曲线变化预测接下来24小时和4小时可能使用的 inodes。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('(node_filesystem_files_free{job="node-exporter",fstype!=""} / node_filesystem_files{job="node-exporter",fstype!=""} * 100 < 20\n        and\n          predict_linear(node_filesystem_files_free{job="node-exporter",fstype!=""}[6h], 4*60*60) < 0\n        and\n          node_filesystem_readonly{job="node-exporter",fstype!=""} == 0)\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("node_filesystem_files_free：空闲的 inode")]),e._v(" "),t("li",[e._v("node_filesystem_files：inodes 总量")])])])]),e._v(" "),t("h3",{attrs:{id:"_9-8、nodefilesystemalmostoutofspace"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-8、nodefilesystemalmostoutofspace"}},[e._v("#")]),e._v(" 9.8、NodeFilesystemAlmostOutOfSpace")]),e._v(" "),t("ul",[t("li",[e._v("分区容量使用率。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('(node_filesystem_avail_bytes{job="node-exporter",fstype!=""} / node_filesystem_size_bytes{job="node-exporter",fstype!=""} * 100 < 10\n        and\n          node_filesystem_readonly{job="node-exporter",fstype!=""} == 0\n        )\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("node_filesystem_avail_bytes：空闲容量")]),e._v(" "),t("li",[e._v("node_filesystem_size_bytes：总容量")])])])]),e._v(" "),t("h3",{attrs:{id:"_9-9、nodefilesystemspacefillingup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-9、nodefilesystemspacefillingup"}},[e._v("#")]),e._v(" 9.9、NodeFilesystemSpaceFillingUp")]),e._v(" "),t("ul",[t("li",[e._v("分区容量耗尽预测，以6小时曲线变化预测接下来24小时和4小时可能使用的容量。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('(node_filesystem_avail_bytes{job="node-exporter",fstype!=""} / node_filesystem_size_bytes{job="node-exporter",fstype!=""} * 100 < 15\n        and\n          predict_linear(node_filesystem_avail_bytes{job="node-exporter",fstype!=""}[6h], 4*60*60) < 0\n        and\n          node_filesystem_readonly{job="node-exporter",fstype!=""} == 0)\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("node_filesystem_avail_bytes：空闲容量")]),e._v(" "),t("li",[e._v("node_filesystem_size_bytes：总容量")])])])]),e._v(" "),t("h2",{attrs:{id:"十、pod相关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#十、pod相关"}},[e._v("#")]),e._v(" 十、Pod相关")]),e._v(" "),t("h3",{attrs:{id:"_10-1、kubepodcrashlooping"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-1、kubepodcrashlooping"}},[e._v("#")]),e._v(" 10.1、KubePodCrashLooping")]),e._v(" "),t("ul",[t("li",[e._v("Pod 重启时间，重启时间超过3m告警。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('rate(kube_pod_container_status_restarts_total{job="kube-state-metrics"}[5m]) * 60 * 3 > 0\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("相关指标:\n"),t("ul",[t("li",[e._v("kube_pod_container_status_restarts_total：重启状态 0 为正常")])])])]),e._v(" "),t("h3",{attrs:{id:"_10-2、kubepodnotready"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-2、kubepodnotready"}},[e._v("#")]),e._v(" 10.2、KubePodNotReady")]),e._v(" "),t("ul",[t("li",[e._v("Pods 没有就绪，检测 Pod 是否就绪。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v(' sum by (namespace, pod) (max by(namespace, pod) (kube_pod_status_phase{job="kube-state-metrics", phase=~"Pending|Unknown"}) * on(namespace, pod) group_left(owner_kind) max by(namespace, pod, owner_kind) (kube_pod_owner{owner_kind!="Job"})) > 0\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kube_pod_status_phase：Pod 状态")])])])]),e._v(" "),t("h3",{attrs:{id:"_10-3、kubedeploymentgenerationmismatch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-3、kubedeploymentgenerationmismatch"}},[e._v("#")]),e._v(" 10.3、KubeDeploymentGenerationMismatch")]),e._v(" "),t("ul",[t("li",[e._v("Deployment 部署失败，Deployment 生成的资源与定义的资源不匹配。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('kube_deployment_status_observed_generation{job="kube-state-metrics"}\n          !=\n        kube_deployment_metadata_generation{job="kube-state-metrics"}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kube_deployment_status_observed_generation：Deployment 生成资源数")]),e._v(" "),t("li",[e._v("kube_deployment_metadata_generation：Deployment 定义资源数")])])])]),e._v(" "),t("h3",{attrs:{id:"_10-4、kubedeploymentreplicasmismatch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-4、kubedeploymentreplicasmismatch"}},[e._v("#")]),e._v(" 10.4、KubeDeploymentReplicasMismatch")]),e._v(" "),t("ul",[t("li",[e._v("查看 Deplyment 副本是否达到预期。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('(\n          kube_deployment_spec_replicas{job="kube-state-metrics"}\n            !=\n          kube_deployment_status_replicas_available{job="kube-state-metrics"}\n        ) and (\n          changes(kube_deployment_status_replicas_updated{job="kube-state-metrics"}[3m])\n            ==\n          0\n        )\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kube_deployment_spec_replicas           资源定义副本数")]),e._v(" "),t("li",[e._v("kube_deployment_status_replicas_available     正在运行副本数")]),e._v(" "),t("li",[e._v("kube_deployment_status_replicas_updated      更新的副本数")])])])]),e._v(" "),t("h3",{attrs:{id:"_10-5、kubestatefulsetreplicasmismatch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-5、kubestatefulsetreplicasmismatch"}},[e._v("#")]),e._v(" 10.5、KubeStatefulSetReplicasMismatch")]),e._v(" "),t("ul",[t("li",[e._v("监测 StatefulSet 副本是否达到预期。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('(\n          kube_statefulset_status_replicas_ready{job="kube-state-metrics"}\n            !=\n          kube_statefulset_status_replicas{job="kube-state-metrics"}\n        ) and (\n          changes(kube_statefulset_status_replicas_updated{job="kube-state-metrics"}[5m])\n            ==\n          0\n        )\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kube_statefulset_status_replicas_ready：就绪副本数")]),e._v(" "),t("li",[e._v("kube_statefulset_status_replicas：当前副本数")]),e._v(" "),t("li",[e._v("kube_statefulset_status_replicas_updated：更新的副本数")])])])]),e._v(" "),t("h3",{attrs:{id:"_10-6、kubestatefulsetupdatenotrolledout"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-6、kubestatefulsetupdatenotrolledout"}},[e._v("#")]),e._v(" 10.6、KubeStatefulSetUpdateNotRolledOut")]),e._v(" "),t("ul",[t("li",[e._v("StatefulSet  更新失败且未回滚，对比版本号和副本数。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('max without (revision) (\n          kube_statefulset_status_current_revision{job="kube-state-metrics"}\n            unless\n          kube_statefulset_status_update_revision{job="kube-state-metrics"}\n        )\n          *\n        (\n          kube_statefulset_replicas{job="kube-state-metrics"}\n            !=\n          kube_statefulset_status_replicas_updated{job="kube-state-metrics"}\n        )\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kube_statefulset_status_replicas：每个 StatefulSet 的副本数。")]),e._v(" "),t("li",[e._v("kube_statefulset_status_replicas_current：每个 StatefulSet 的当前副本数。")]),e._v(" "),t("li",[e._v("kube_statefulset_status_replicas_ready：每个StatefulSet 的就绪副本数。")]),e._v(" "),t("li",[e._v("kube_statefulset_status_replicas_updated：每个StatefulSet 的更新副本数。")]),e._v(" "),t("li",[e._v("kube_statefulset_status_observed_generation：StatefulSet 控制器观察到的生成。")]),e._v(" "),t("li",[e._v("kube_statefulset_replicas：StatefulSet 所需的副本数。")]),e._v(" "),t("li",[e._v("kube_statefulset_metadata_generation：表示 StatefulSet 所需状态的特定生成的序列号。")]),e._v(" "),t("li",[e._v("kube_statefulset_created：创建时间戳。")]),e._v(" "),t("li",[e._v("kube_statefulset_labels：Kubernetes 标签转换为 Prometheus 标签。")]),e._v(" "),t("li",[e._v("kube_statefulset_status_current_revision：指示用于按顺序(0，currentReplicas)生成 Pod 的StatefulSet 的版本。")]),e._v(" "),t("li",[e._v("kube_statefulset_status_update_revision：指示用于按顺序 [replicas-updatedReplicas，replicas] 生成 Pod 的 StatefulSet 的版本。")])])])]),e._v(" "),t("h3",{attrs:{id:"_10-7、kubedaemonsetrolloutstuck"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-7、kubedaemonsetrolloutstuck"}},[e._v("#")]),e._v(" 10.7、KubeDaemonSetRolloutStuck")]),e._v(" "),t("ul",[t("li",[e._v("监测 DaemonSet 是否处于就绪状态。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('kube_daemonset_status_number_ready{job="kube-state-metrics"}\n          /\n        kube_daemonset_status_desired_number_scheduled{job="kube-state-metrics"} < 1.00\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kube_daemonset_status_number_ready：就绪的 DaemonSet")]),e._v(" "),t("li",[e._v("kube_daemonset_status_desired_number_scheduled：应该调度的 DaemonSet 数量")])])])]),e._v(" "),t("h3",{attrs:{id:"_10-8、kubedaemonsetmisscheduled"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-8、kubedaemonsetmisscheduled"}},[e._v("#")]),e._v(" 10.8、KubeDaemonSetMisScheduled")]),e._v(" "),t("ul",[t("li",[e._v("DaemonSet  运行在不该运行的节点上面。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('kube_daemonset_status_number_misscheduled{job="kube-state-metrics"} > 0\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kube_daemonset_status_number_misscheduled：运行在不该运行的节点状态")])])])]),e._v(" "),t("h3",{attrs:{id:"_10-9、kubecontainerwaiting"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-9、kubecontainerwaiting"}},[e._v("#")]),e._v(" 10.9、KubeContainerWaiting")]),e._v(" "),t("ul",[t("li",[e._v("监测哪些容器是在等待状态的。表达式：")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('sum by (namespace, pod, container) (kube_pod_container_status_waiting_reason{job="kube-state-metrics"}) > 0\n\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("ul",[t("li",[e._v("相关指标：\n"),t("ul",[t("li",[e._v("kube_pod_container_status_waiting_reason：容器声明周期过程中的状态，无论是创建成功还是失败都应该是0。")])])])]),e._v(" "),t("p"),e._v(" "),t("p")])}),[],!1,null,null,null);s.default=r.exports}}]);